# CS207 Digital Logic

------

# PROJECT 02 REPORT

# A Real Car

------

- 小组成员：张天悦（学号：12112908）罗嘉诚（学号：12112910）
- 完成日期：2023 年 01 月 08 日

## 项目开发计划

### 小组选题

在进行项目选题时，我们非常慎重地比较了两个选题 **A Real Car** 以及 **Self-service Washing Machine**。

我们在选组选题时主要遵循了 **NABCD** 原则（即 Need 需求、Approach 实现、Benefits 效益、Competitors / Companion 竞争者 / 同伴、Delivery 推广）进行**需求分析**。

基于小组实际，选题时我们认为前者 **A Real Car** 相较于后者 **Self-service Washing Machine**，有如下优势，更加适合本小组开展工作：

- Need 需求：2022 年 秋季学期，**数字逻辑**课程的期末项目，需要高效高质量地完成两个指定项目（**A Real Car**  或者 **Self-service Washing Machine**）中的一个。
- Approach 实现：小车项目具有较为完善的**测试环境**，并且通过 **UART 模块**和**相关模拟器**，可通过应用程序 **DriveCar.exe** 显示项目的**实际效果**，非常有获得感，很有意思。
- Benefits 效益：小车项目简洁实用，更加**贴近生活**，功能直接了然，容易理解，能让小组成员快速上手，进行**高效率工作**。这也能为更好地完善小车项目留出充足的时间，获得**更高的分数**。
- Competitors / Companion 竞争者 / 同伴：根据前期了解，在选择项目时选择 **A Real Car** 项目的小组更**多，**若尝试选择人数较多的项目，便于组间的**交流和学习**，也能在期末演示中看到更多优质项目。这能更好的**提高自己的能力**。
- Delivery 推广：我们的项目在提交后，就在 **GitHub** 中开源了，由于小车项目有较为完善的测试环境，可以让**更多的朋友**看到我们的项目，并且**便于测试**，能更好的发现**项目中的不足**。

根据以上分析，我们绘制了两个项目（小车项目A Real Car、洗衣机项目 Self-service Washing Machine）选题对比的**雷达图**，以此为依据最终确定小组项目选题。

| 选题对比                              | 最大值<br>Maximum | 小车项目<br>A Real Car | 洗衣机项目<br>Self-service Washing Machine |
| ------------------------------------- | ------ | -------------------- | ---------------------------------------- |
| Need（需求）                         | 10     | 9                    | 8                                        |
| Approach（实现）                       | 10     | 9                    | 7                                        |
| Benefits（效益）                       | 10     | 10                   | 9                                        |
| Competitors / Companion（竞争者 / 同伴） | 10     | 9                    | 5                                        |
| Delivery（推广）                       | 10     | 8                    | 8                                        |

<img src="https://raw.githubusercontent.com/Maystern/picbed/main/image-20230102143153701.png" alt="image-20230102143153701" style="zoom:40%;" />

基于以上分析，我们小组慎重地选择了 **A Real Car** 作为 2022 年 秋季学期**数字逻辑**课程的期末项目。

### 成员分工

在筹建项目小组时，我们希望小组**人数较少**，这能很方便地进行项目**同步协作**，同时也能**避免摸鱼摆烂**现象的发生。在同步协作**方法**上，我们小组主要通过 **GitHub** 中的相关仓库进行项目同步，非常方便高效。

同时，由于参与开发的小组成员较少，每位小组成员的**工作压力都较大**，需要完成相当数量的工作。所以更加需要**科学安排**每位小组成员的任务，高效率、高质量地完成本次项目。

在考虑**个人贡献**分配时，我们兼顾**效率和公平**，从如下 5 个方面，对每位小组成员在团队中的贡献进行衡量：

- 工作**数量**（成员在团队项目中所投入的精力）
- 工作**质量**（避免低效拖沓，最重要的是代码是否能正常运行，并且做到 **Bug Free**）
- 工作**参考价值**（工作成果对于整个团队项目进度的推进程度、对于他人是否积极提供帮助互相进步等）
- 工作**投入程度**（成员在项目中的用心程度和态度）
- 其他**特别贡献**（对整个团队有特殊贡献的部分）

根据以上原则，兼顾效率和公平，小组成员**达成一致**，最终的**项目贡献分配比**为：

| 小组成员                 | 贡献比 |                             评价                             |
| ------------------------ | ------ | :----------------------------------------------------------: |
| 张天悦（学号：12112908） | 50%    | 高效高质量地完成所有既定工作，并且工作对<br>团队有重要参考价值，工作态度和投入程度佳，<br/>在实现项目 **VGA** 功能（**Bonus**）对项目有特别贡献。 |
| 罗嘉诚（学号：12112910） | 50%    | 高效高质量地完成所有既定工作，并且工作对<br/>团队有重要参考价值，工作态度和投入程度佳，<br/>在实现项目 **Auto Driving** 功能（**Bonus**）对项目有特别贡献。 |

<div style="page-break-after:always;"></div>

具体成员分工如下：

|         小组成员         | 具体分工                                                     |
| :----------------------: | :----------------------------------------------------------- |
| 张天悦（学号：12112908） | ① 全局状态控制（**Global State**）20%<br>  ② 手动挡位（**Manual Driving**）离合、刹车、油门、里程表控制 30% <br>  ③ **VGA** 显示（**Bonus**）20%<br>  ④ 前期设计、资料收集、项目测试、报告写作、视频录制等 |
| 罗嘉诚（学号：12112910） | ① 手动挡位（**Manual Driving**）倒挡、左转、右转、UART 连接 20%<br>  ② 半自动挡位（**Semi-Auto Driving**）30% <br>  ③ 全自动挡位（**Auto Driving**，**Bonus**）20%<br>  ④ 前期设计、资料收集、项目测试、报告写作、视频录制等 |

### 执行记录

我们以项目进行过程中实现的**重要功能**、完成的**重要事件**节点为单位，项目的执行记录，汇总如下：

| 时间       | 经办人                                             | 事件                                                         |
| ---------- | -------------------------------------------------- | ------------------------------------------------------------ |
| 2022.11.11 | 罗嘉诚、张天悦                                     | **项目组队**                                                 |
| 2022.11.16 | 2022 Fall<br>数字逻辑教学团队                      | **项目发布**                                                 |
| 2022.11.17 | 张天悦                                             | 填写项目组队在线表格（**确认组队**）                         |
| 2022.11.18 | 罗嘉诚、张天悦                                     | 第 1 次 Lab 课讨论<br>（EGO1 开发板**领取**、**讨论**课程项目**选题**问题、后续大致**时间安排**） |
| 2022.11.25 | 罗嘉诚、张天悦                                     | 第 2 次 Lab 课讨论<br/>（确定项目**选题**为：**A Real Car**，**规划**中期答辩前需要完成内容：<br>全局状态控制（**Global State**）、手动挡位（**Manual Driving**）） |
| 2022.11.27 | 张天悦                                             | 完成全局状态控制（**Global State**）20% 模块的 **Verilog 代码**编写、**仿真** |
| 2022.11.28 | 张天悦                                             | 完成全局状态控制（**Global State**）20% 模块的**上板测试**，功能正常 |
| 2022.11.29 | 罗嘉诚                                             | 明确 **UART** 连接的方法，实现一些**简单测试功能**、能实现与应用程序**交互** |
| 2022.11.30 | 罗嘉诚                                             | 完成**左转、右转**相关功能的 **Verilog 代码**编写、**仿真**  |
| 2022.11.31 | 张天悦                                             | 完成**离合、刹车、油门**相关功能的 **Verilog 代码**编写、**仿真** |
| 2022.12.02 | 罗嘉诚、张天悦                                     | 第 3 次 Lab 课讨论<br/>（项目进度汇总、项目**整合**后进行**上板测试**，功能正常） |
| 2022.12.04 | 张天悦                                             | 完成**里程表**相关功能的 **Verilog 代码**编写、**仿真**      |
| 2022.12.05 | 张天悦                                             | 完成**里程表**相关功能的**上板测试**，功能正常               |
| 2022.12.08 | 罗嘉诚                                             | 完成全局状态控制（**Global State**）、手动挡位（**Manual Driving**）<br>两部分进行**功能整合** |
| 2022.12.09 | 罗嘉诚、张天悦                                     | 第 4 次 Lab 课讨论<br/>（**上板测试**项目已经完成部分，全局状态控制（**Global State**）、<br>手动挡位（**Manual Driving**）功能正常，**讨论中期答辩相关安排**） |
| 2022.12.13 | 2022 Fall<br>数字逻辑教学团队                      | 更改项目期中答辩形式为**视频录制**，对于周五 Lab 课小组 DDL 提前 |
| 2022.12.14 | 罗嘉诚、张天悦                                     | 明确中期答辩形式为**展示 40% 的上板功能**，进行上板功能测试，测试正常 |
| 2022.12.15 | 罗嘉诚、张天悦                                     | 拍摄、**剪辑**中期答辩演示视频，并如期**提交**中期答辩相关材料 |
| 2022.12.16 | 罗嘉诚、张天悦、<br>2022 Fall<br/>数字逻辑教学团队 | 第 5 次 Lab 课**中期答辩**<br/>（向王薇老师进行项目中期答辩，被提出一些重要的**问题和建议**） |
| 2022.12.20 | 罗嘉诚                                             | 针对中期答辩中出现的问题，**修改完善代码**，进行**上板功能测试**，测试正常 |
| 2022.12.23 | 2022 Fall<br/>数字逻辑教学团队                     | 中期答辩成绩出炉：`5 / 5`                                    |
| 2022.12.24 | 罗嘉诚                                             | 完成半自动挡位（**Semi-Auto Driving**）30% 的 **Verilog** **代码**编写，**仿真** |
| 2022.12.25 | 罗嘉诚                                             | 完成半自动挡位（**Semi-Auto Driving**）30% 的 **上板测试**，功能正常 |
| 2022.12.26 | 2022 Fall<br/>数字逻辑教学团队                     | 通知项目延期约 1 周，更改最终项目**展示形式**为**视频录制**、**报告撰写** |
| 2022.12.29 | 张天悦                                             | 完成  **VGA** 显示（**Bonus**）20% 的 **Verilog** **代码**编写，**仿真** |
| 2022.12.30 | 张天悦                                             | 完成  **VGA** 显示（**Bonus**）20% 的**上板测试**，功能正常  |
| 2022.12.31 | 罗嘉诚                                             | 完成全自动挡位（**Auto Driving**，**Bonus**）20% 的 **Verilog** **代码**编写，**仿真** |
| 2023.01.01 | 罗嘉诚                                             | 完成全自动挡位（**Auto Driving**，**Bonus**）20% 的上板测试，功能正常 |
| 2023.01.02 | 罗嘉诚                                             | 当前已经完成项目部分（全局状态控制（**Global State**）20%、<br>手动挡位（**Manual Driving**）50%、半自动挡位（**Semi-Auto Driving**）30%、<br>全自动挡位（**Auto Driving**，**Bonus**）20%）**整合**后进行**上板测试**，<br>所有功能均正常 |
| 2023.01.03 | 张天悦                                             | 项目所有部分（全局状态控制（**Global State**）20%、<br/>手动挡位（**Manual Driving**）50%、半自动挡位（**Semi-Auto Driving**）30%、<br/>全自动挡位（**Auto Driving**，**Bonus**）20%、**VGA** 显示（**Bonus**）20%）<br>**整合**后进行最终**上板测试**，所有功能均正常 |

### 开源

本项目已经基于 MIT License 协议在 **GitHub** 上开源了，推荐您进入仓库查看。

项目地址：https://github.com/Maystern/SUSTech_DigitalLogic_Project_a-real-car

使用方法：

1. `git clone https://github.com/Maystern/SUSTech_DigitalLogic_Project_a-real-car.git`

2. 进入获得的 `SUSTech_DigitalLogic_Project_a-real-car` 文件夹下的 `src` 目录。
3. 使用 **Vivado** 打开 `SUSTech_DigitalLogic_Project_a-real-car.xpr`，打开工程。

## 使用文档与说明

项目使用 EGO1 开发板，系统电路在开发板上使用的输入输出设备在下图中给出了标注：

![image-20230102214224694](https://raw.githubusercontent.com/Maystern/picbed/main/image-20230102214224694.png)

图中，我们使用了**红色**线框图表示 **EGO1** 开发板自带的输入输出设备及相关说明。

- `TypeC接口`：**EGO1** 提供的该 typeC 接口功能为 UART 和 JTAG，该接口可以为板卡供电。板卡上提供电压转换电路将 TypeC 输入的 5V 电压转换为板卡上各类芯片需要的工作电压。上电成功后`开启状态`LED灯点亮。
- `开启状态`：该 LED 灯的亮灭表示开发板是否开启，对应引脚 D18。
- `拨码开关`：该拨码开关控制 **EGO1** 开发板的启动和关闭，当拨至 `ON` 时，开发板将启动，当拨至 `OFF` 时，开发板将关闭。
- `擦除FPGA配置`：即 **PROG#**，是专用按键，按下后用来擦除FPGA配置。

图中，我们使用了**绿色**线框图表示小车系统进行**全局设置**时，使用的相关输入输出设备及相关说明。

- `点火按钮`：该按钮控制小车点火，若当前小车引擎熄火，则需要长按该按钮 **1s**，使得小车重新启动，对应引脚 R15。
- `熄火按钮`：该按钮控制小车熄火，若当前小车引擎打开，若按下该按钮，小车立即熄火，对应引脚 P15。
- `引擎开启状态`：该 LED 灯显示小车引擎是否开启，若当前小车熄火，LED灯不亮；若小车引擎开启，LED亮，对应引脚 K1。
- `驾驶模式调节`：这一组 3 个拨码开关，用来切换小车的模式。拨码开关从左至右，依次表示是否开启手动模式、是否开启半自动模式、是否开启全自动模式。当且仅当其中一个拨码开关打开时，将进入对应的驾驶模式。手动模式、半自动模式、全自动模式从左至右依次对应引脚 M4、N4、R1。
- `驾驶模式状态`：这一组 3 个 LED 灯，用来显示小车当前所在的驾驶模式。LED 灯从左至右，依次对应手动模式是否开启、半自动模式是否开启、全自动模式是否开启，当对应 LED 亮时，表明进入其中的对应驾驶模式。特别地，当 3 个 LED 灯均不亮时，小车未进入任何一种驾驶模式，原地静止。

图中，我们使用了**紫色**线框图表示小车系统进行**手动驾驶模式**时，使用的相关输入输出设备及相关说明。

- `左转向灯`：该 LED 灯显示小车进入手动驾驶模式后的左转状态。若小车所处其他模式，该 LED 不亮；当小车进入手动驾驶模式，并且处在`未启动`状态时，该 LED 灯长亮，处在`启动中`状态时，该 LED 灯不亮，处在 `移动中` 并且执行左转向时，该 LED 灯闪亮。对应引脚 G4。
- `右转向灯`：该 LED 灯显示小车进入手动驾驶模式后的右转状态。若小车所处其他模式，该 LED 不亮；当小车进入手动驾驶模式，并且处在`未启动`状态时，该 LED 灯长亮，处在`启动中`状态时，该 LED 灯不亮，处在 `移动中` 并且执行右转向时，该 LED 灯闪亮。对应引脚 J4。
- `倒挡`：该拨码开关用来设置小车进入手动驾驶模式后，是否进入倒车状态。若该拨码开关关闭，小车受到`离合器`、`刹车`、`油门`的共同作用向前移动；若该拨码开关打开，小车受到`离合器`、`刹车`、`油门`的共同作用向后移动。对应引脚 P5。
- `离合器`：该拨码开关用来设置小车进入手动驾驶模式后的离合器状态。若该拨码开关关闭，小车离合器不踩下；若该拨码开关打开，小车离合器踩下。小车受到`离合器`、`刹车`、`油门`的共同作用移动。对应引脚 P4。
- `刹车`：该拨码开关用来设置小车进入手动驾驶模式后的刹车状态。若该拨码开关关闭，小车刹车不踩下；若该拨码开关打开，小车刹车踩下。小车受到`离合器`、`刹车`、`油门`的共同作用移动。对应引脚 P3。
- `油门`：该拨码开关用来设置小车进入手动驾驶模式后的油门状态。若该拨码开关关闭，小车油门不踩下；若该拨码开关打开，小车油门踩下。小车受到`离合器`、`刹车`、`油门`的共同作用移动。对应引脚 P2。
- `里程表`：里程表由 8 个共阴极数码管构成，用来显示当前小车手动驾驶模式时的运行里程。对应引脚较为复杂，需要使用到的引脚有：B4、A4、A3、B1、A1、B3、B2、D5、D4、E3、D3、F4、F3、E2、D2、H2（数码管的段选信号），G2、C2、C1、H1、G1、H1、G1、F1、E1、G6（数码管的片选信号）。

图中，我们使用了**蓝色**线框图表示小车系统进行**半自动驾驶模式**时，使用的相关输入输出设备及相关说明。

- `前进按钮`：该按钮用来接收小车进入岔路口后是否通过前进方式通过岔路口。若该按钮按下，表示小车将以前进通过岔路口。对应引脚 U4。
- `左转按钮`：该按钮用来接收小车进入岔路口后是否通过左转方式通过岔路口。若该按钮按下，表示小车将左转通过岔路口。对应引脚 V1。
- `右转按钮`：该按钮用来接收小车进入岔路口后是否通过右转方式通过岔路口。若该按钮按下，表示小车将右转通过岔路口。对应引脚 R11。
- `掉头按钮`：该按钮用来接收小车进入岔路口后是否通过掉头方式通过岔路口。若该按钮按下，表示小车将掉头通过岔路口。对应引脚 R17。

图中，我们使用了**橙色**线框图表示小车系统能外接显示器输出使用的相关输入输出设备及相关说明。

- `VGA接口`：该接口可以使用连接线与外接显示器相连，用来显示当前小车运行的状态（包括运行里程、运行模式灯），对应引脚 J1。

